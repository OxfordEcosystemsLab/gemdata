require 'spec_helper'
require 'csv'
require 'importer'

describe SpectraMeasurementImporter do

  it_behaves_like 'Importer'

  before :each do
    @leaf = set_up_leaf('ACJ01', 'T846', 'B11H', 'L1')
  end

  it 'can read csv' do
    values = CSV.parse_line 'Weinmania fagaroides,Acj01-T846-B11H,pah,1,1,top_ref,0.1961556493,0.1110266713,0.068227401,0.0946512247,0.0871117543,0.0903331087,0.107636811,0.0980097043,0.0816796127,0.104879311,0.1236158883,0.1075277003,0.076617112,0.0575422973,0.078481015,0.084810616,0.069627055,0.074209522,0.0877787577,0.092549866,0.0828968803,0.0690894397,0.0793938787,0.076766536,0.0612451077,0.0720453093,0.0860855533,0.0708224153,0.0632317603,0.070773287,0.0707240587,0.0689393173,0.0688419013,0.079828629,0.0897728137,0.0747226813,0.065622632,0.0726714363,0.0757890593,0.0758580077,0.074291378,0.0732231423,0.073398457,0.0728926303,0.0682639063,0.0611588367,0.0660266567,0.076118037,0.0764962237,0.0737657283,0.0703760733,0.0716370957,0.0750541187,0.074907869,0.074858047,0.0742094527,0.0692400633,0.0674324803,0.072005516,0.0718333337,0.069595877,0.073064613,0.076109672,0.0774705873,0.0732449917,0.0692539193,0.0719848887,0.0716871107,0.0684861177,0.0690315373,0.0701373583,0.0700953997,0.0706374467,0.0711064233,0.0699454897,0.0707295323,0.073072483,0.0711242377,0.069298046,0.070342367,0.0710576677,0.0708229857,0.0701205007,0.0699099533,0.0699286097,0.069940407,0.0698200313,0.0684410037,0.0681103623,0.0694616903,0.0691018697,0.068779995,0.069464725,0.0700126653,0.0698940823,0.0694314143,0.0688252813,0.0686055193,0.0687608067,0.0689174197,0.0686392253,0.0687230747,0.0693114667,0.0695757563,0.069306001,0.0689253267,0.068793689,0.0690335043,0.0696143023,0.0696537993,0.0687874033,0.0690101913,0.0698444823,0.0700267037,0.0701486273,0.0701390753,0.070085086,0.0699081393,0.0694334487,0.069449929,0.0699823893,0.0704412763,0.0703792817,0.0698235567,0.0697951077,0.0702805843,0.0708361577,0.0709897173,0.0706777903,0.0703597237,0.070367931,0.070745383,0.0706244087,0.0702121487,0.070470343,0.0707463177,0.0707679763,0.0707126807,0.070583738,0.0705225933,0.070349458,0.0702136727,0.0705049003,0.070683262,0.0704457047,0.0703553093,0.070419035,0.0704430737,0.070292987,0.070053662,0.070146912,0.0703427663,0.0704240023,0.0703622133,0.0701528483,0.0700660797,0.070159822,0.0702792037,0.0702263223,0.070096762,0.0700077967,0.0699421503,0.0698871663,0.0699563663,0.069998882,0.0697930063,0.0696737763,0.0697913933,0.0699686427,0.069999406,0.0698494773,0.0697775467,0.069829046,0.0698914237,0.069888213,0.0699473427,0.0700120517,0.069996901,0.0699306547,0.0700283937,0.0702129133,0.070049669,0.0700805507,0.070545967,0.0707398457,0.070691929,0.0708336237,0.0711719083,0.0715868757,0.0717237887,0.0717806587,0.0723384373,0.0729001957,0.073283713,0.0735054503,0.0738543563,0.0746013923,0.075168842,0.07560839,0.0763569523,0.0772021563,0.0779539907,0.07858125,0.0791838997,0.079892295,0.080540861,0.081061026,0.081551593,0.081984211,0.0824456237,0.082903864,0.083302135,0.083682034,0.0840576317,0.0844205347,0.0846086327,0.084731602,0.0849183603,0.085128416,0.0854088453,0.0856613637,0.0858421827,0.085900706,0.086087324,0.08639593,0.0866278933,0.086741539,0.0867950493,0.086840694,0.086857814,0.0868322113,0.086639787,0.0862902873,0.086111181,0.0859310387,0.0855490377,0.0851355867,0.0847393537,0.0842799443,0.0838176597,0.0833077807,0.082743119,0.082153342,0.081615943,0.0810990243,0.0805957237,0.0800163073,0.0794547143,0.079017544,0.0786084287,0.0782211923,0.0778837377,0.0775829077,0.0773632383,0.0770917923,0.076828246,0.0766908177,0.0765177583,0.076278107,0.0761721947,0.0760780957,0.075847937,0.0756413023,0.075470608,0.075321637,0.0752046137,0.075126021,0.0750117457,0.074804997,0.0745400923,0.074306985,0.0740780787,0.073767583,0.0732967233,0.0726375997,0.07189117,0.0711235367,0.0704345633,0.070077865,0.070158791,0.070153106,0.0703385677,0.071142937,0.0719589853,0.0727190653,0.0738062367,0.0748286993,0.07544831,0.0758557103,0.0761101453,0.0763142247,0.0762559883,0.0757743743,0.0751295357,0.074390075,0.0734379317,0.07265306,0.0721278,0.0717335043,0.071444108,0.0712380737,0.0712273303,0.071343641,0.0714462393,0.071587211,0.0717589153,0.07188112,0.071933608,0.0719330267,0.071924435,0.0719127523,0.0719149077,0.071895764,0.071847919,0.0717118527,0.07154187,0.0714830187,0.0713876427,0.071230351,0.0711858443,0.0711888293,0.0711214573,0.07100857,0.0708895053,0.070792056,0.0707300093,0.0706924657,0.0705988557,0.0704973273,0.070528312,0.070514894,0.070401552,0.070334814,0.070257006,0.0701978383,0.070205278,0.0702103823,0.070053015,0.0699524487,0.0699723637,0.0699664053,0.069921534,0.069875513,0.0698347037,0.0698408407,0.0700114833,0.070117472,0.0701114903,0.0702146343,0.070326583,0.07030892,0.070350928,0.0704915957,0.070614967,0.0707685873,0.070934911,0.071024828,0.071101949,0.0713313433,0.071619006,0.0719028197,0.0720968537,0.0722848413,0.0725783543,0.0729072877,0.0732434643,0.073657336,0.074206606,0.0749781057,0.075820339,0.0768013167,0.078134849,0.079790518,0.0818364077,0.084384388,0.0874422533,0.0909791007,0.095010922,0.0995855913,0.104789195,0.110431474,0.1164567643,0.1229536657,0.1298925543,0.137246614,0.1449263093,0.152889263,0.161057677,0.1694655773,0.1781511223,0.1872214483,0.1965631503,0.205980298,0.2154950037,0.2250929097,0.234764983,0.2444301963,0.254024825,0.263673249,0.2732812217,0.2826048793,0.2917496357,0.30074982,0.309487749,0.317905927,0.3259436907,0.3337507033,0.34130285,0.3484972413,0.3553818357,0.3619454803,0.3681088743,0.3739448293,0.3796097867,0.3849151237,0.3898360223,0.394477128,0.3987863877,0.4027559843,0.4064753527,0.409980383,0.413354214,0.4164987167,0.4193518993,0.421894498,0.4242528363,0.4265082303,0.4285879907,0.4304680473,0.4321395587,0.4336756783,0.4351012747,0.436269878,0.4373593753,0.4385698447,0.439748596,0.440767293,0.441372976,0.4419188933,0.442635266,0.4435220323,0.444377127,0.444894761,0.445261362,0.4455304443,0.4456932483,0.44604943,0.446706383,0.4471325983,0.4473605817,0.4476639403,0.447962495,0.4482428257,0.4484196043,0.4485737093,0.448783948,0.449005634,0.44924266,0.4495185953,0.4497445737,0.4498958857,0.4501231107,0.4503293197,0.4503961743,0.4504562947,0.450583917,0.4508432177,0.4511215393,0.4514006053,0.4516493493,0.4517493253,0.4515976853,0.4516062713,0.4518099227,0.4520749053,0.4523811347,0.4526337757,0.45268388,0.452663252,0.452745297,0.4529646363,0.453295918,0.4535777943,0.4536938437,0.453636154,0.4536356687,0.4537253993,0.453908569,0.4541301687,0.4543489857,0.4544235817,0.4544929387,0.4546530437,0.454771973,0.45491569,0.4552147807,0.4554043883,0.45545968,0.4556064557,0.4558184693,0.4560345433,0.4560076577,0.4559424967,0.456269834,0.45652312,0.4565996743,0.4567636437,0.4569026893,0.457024284,0.4572284183,0.457447324,0.457567684,0.4578295167,0.4582339617,0.4584327643,0.4585221337,0.45860967,0.4587682407,0.4589185303,0.4588944473,0.4590992933,0.4595297703,0.4596789693,0.4599197193,0.4603692823,0.4604661777,0.4604098893,0.4606086057,0.4608142043,0.4610049523,0.4612770527,0.461483784,0.4615250373,0.4616378093,0.461843663,0.4620522787,0.4622748367,0.4625404633,0.462715458,0.462927205,0.4632276147,0.4632299413,0.4631397797,0.4632943917,0.4634494287,0.4635899693,0.4638686507,0.4640203077,0.463965589,0.464066293,0.464229932,0.4643338433,0.4644880397,0.464640234,0.464638988,0.4646753457,0.4647645413,0.4648003123,0.4649084307,0.465139793,0.465308291,0.465452621,0.4655625997,0.465752268,0.4659690277,0.465933084,0.4658566013,0.465877531,0.4659082623,0.4659818403,0.465945846,0.4661375277,0.466508054,0.466514105,0.4665822983,0.4668880487,0.4668586503,0.466716145,0.466908799,0.466911799,0.466799816,0.467293532,0.467573658,0.467262871,0.467323268,0.4674848483,0.46731308,0.4675092133,0.4680245673,0.468095049,0.468140188,0.4682541377,0.4681783427,0.4680804773,0.468045994,0.4681639287,0.468294796,0.4683277437,0.4682327593,0.4681308527,0.468570899,0.4687465223,0.468289053,0.46821064,0.468335583,0.468152834,0.4680642957,0.4681076117,0.467983752,0.467919956,0.4679082887,0.4678162707,0.4677248457,0.467415206,0.4669024313,0.466596779,0.466922117,0.466947647,0.466502995,0.4667195133,0.4666383687,0.465798368,0.465711646,0.4657131507,0.464550292,0.4640600567,0.4642837897,0.4640193133,0.4635138123,0.462919229,0.4622635843,0.461765425,0.461520619,0.461112959,0.4607413603,0.460697228,0.4603846913,0.4599016237,0.460057181,0.460007143,0.4597166187,0.4598401467,0.4599068917,0.4594265743,0.459232952,0.4593297863,0.459536465,0.4593271863,0.458912422,0.4594708137,0.4600252727,0.4601241663,0.460113388,0.459983677,0.460188557,0.4603473877,0.460580881,0.4610442987,0.461099171,0.460878375,0.46108984,0.4615635143,0.4619824347,0.4625041117,0.4627352057,0.4620327697,0.46206839,0.4627618913,0.462497167,0.4625086153,0.4632531913,0.4635358097,0.4641917583,0.4650969217,0.4645589977,0.4638466843,0.464834295,0.4652118157,0.4649544637,0.4658177493,0.4665031857,0.4667973673,0.4677424437,0.4680859863,0.4673528457,0.4683630753,0.469379678,0.4682993447,0.4684780107,0.4696746947,0.4696793613,0.4695542307,0.469624661,0.469365562,0.469667517,0.4713195053,0.471778376,0.4712312563,0.4708490217,0.4706123457,0.4706648667,0.4722667367,0.472434854,0.4708362047,0.471010403,0.4712272983,0.4710472213,0.472502534,0.4743304533,0.4741329377,0.4748434423,0.4765834037,0.4770130047,0.4758941367,0.474104963,0.474674811,0.4759159203,0.476753742,0.475778487,0.4756169737,0.477099469,0.4773108713,0.4772566077,0.4785399033,0.478001609,0.4765496967,0.4774948577,0.4773359557,0.4761125493,0.4773446743,0.477267314,0.4754083327,0.4772465713,0.4792256727,0.4785314547,0.476794457,0.4758625563,0.4767200433,0.4779996083,0.479532474,0.4789269833,0.4799871557,0.4821392927,0.4808118177,0.479272645,0.4780618237,0.477733173,0.478021809,0.4775458847,0.4770590903,0.4771299947'

    importer = SpectraMeasurementImporter.new(1, 2)
    status = importer.read_row(values, Array.new)
    expect(status).to eq(Lookup::ImportStatus.inserted)

    sm = importer.object
    expect(sm).to be_valid
    expect(sm.leaf).to eq(@leaf)
    expect(sm.branch).to eq('1')
    expect(sm.order).to eq('1')
    expect(sm.comments).to eq('pah')
    expect(sm.type).to eq('top_ref')
    expect(sm.measurement_350).to eq(0.1961556493)
    expect(sm.measurement_1100).to eq(0.4771299947)
  end

end

